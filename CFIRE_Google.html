<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

    <style>
        /* Always set the map height explicitly to define the size of the div
         * element that contains the map. */
        #map {
            width: 600px;
            height: 480px;
        }
        /* Optional: Makes the sample page fill the window. */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
    <script>
        var map;
        var geocoder;
        var userlocation;
        var icons = {
            icon1: "./img/marker-blue.png",
            icon2: "./img/marker-gold.png"
        }

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 44.5401392, lng: -85.1304146},
                zoom: 6
            });
            geocoder = new google.maps.Geocoder();

            //Load KML layers
//            $.get('http://projects.glc.org/rsm/map2.php', function (raw_cdf){
            $.get('./data/map2.php', function (raw_cdf){
                    var lines = raw_cdf.split('\n');
                    for(var i = 1;i< lines.length;i++){
                        var line = lines[i].split('\t');
                        var coords = line[0].split(',');

                        var marker = new google.maps.Marker({
                            position: {lat: parseFloat(coords[0]), lng: parseFloat(coords[1])},
                            icon: icons['icon1'],
                            map: map
                        })

                        var infowindow = new google.maps.InfoWindow({
//                            content: line[2]
                        });

                        var content = line[1] + line[2];

                        google.maps.event.addListener(marker,'click', (function(marker,content,infowindow){
                            return function() {
                                infowindow.setContent(content);
                                infowindow.open(map,marker);
                            };
                        })(marker,content,infowindow));

//                        marker.addListener('click', function() {
//                            infowindow.open(map, marker);
//                        });
                    }

                });

            $.get('./data/map1.php', function (raw_harbor){
                var lines = raw_harbor.split('\n');
                for(var i = 1;i< lines.length;i++){
                    var line = lines[i].split('\t');
                    var coords = line[0].split(',');

                    var marker = new google.maps.Marker({
                        position: {lat: parseFloat(coords[0]), lng: parseFloat(coords[1])},
                        icon: icons['icon2'],
                        map: map
                    });

                    var infowindow = new google.maps.InfoWindow({
//                            content: line[2]
                    });

                    var content = line[1] + line[2];

                    google.maps.event.addListener(marker,'click', (function(marker,content,infowindow){
                        return function() {
                            infowindow.setContent(content);
                            infowindow.open(map,marker);
                        };
                    })(marker,content,infowindow));

                }

            });
        }

        function codeAddress() {
            var address = document.getElementById('address-input').value;
            geocoder.geocode( { 'address': address}, function(results, status) {
                if (status == 'OK') {
                    map.setCenter(results[0].geometry.location);
                    userlocation = new google.maps.Marker({
                        map: map,
                        position: results[0].geometry.location
                    });
                    document.getElementById("find-harbor-btn").disabled = false;
                    document.getElementById("find-cdf-btn").disabled = false;
                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        }

        function findHarbor(){

        }

        function findCDF(){

        }


    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBSj85a54PyFg9uaKAg-EvuqhcP8QJW2Rw&libraries=geometry,places&callback=initMap"
            async defer></script>
</head>
<body>
<div>
    <div id="map"></div>
</div>
<div>
    <div>
        <label for="address-input">Your Address: </label>
        <input type="text" id="address-input">
        <input type="button" id="address-btn" onclick="codeAddress()" value="Locate">
        <input type="button" id="find-harbor-btn" onclick="findHarbor()" value="Find Near Harbors" disabled>
        <input type="button" id="find-cdf-btn" onclick="findCDF()" value="Find Near CDFs" disabled>
    </div>
</div>


</body>
</html>