<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <link rel="shortcut icon" href="">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dc/2.0.1/dc.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dc/2.0.1/dc.min.css">
    
    <script src="http://colorbrewer2.org/export/colorbrewer.js"></script>
   
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/stock/highstock.js"></script>

    <script>
        function createOptions(container, title, xAxis, yAxisTitle, series) {
            return {
                chart: {
                    renderTo: container,
                    defaultSeriesType: 'line'
                },
                title: {
                    text: title
                },
                xAxis: {
                    categories: xAxis
                },
                yAxis: {
                    title: {
                        text: yAxisTitle
                    }
                },
                series: series
            }
        }

        function createRiver(name) {
            var river = {
                River: name,
                loads: {                   
                    TP: [],
                    DRP:[]
                },
                ual: {
                    TP: [],
                    DRP: []
                },
                flowWeighted: {
                    TP: [],
                    DRP: []
                },
                timeWeighted: {
                    TP: [],
                    DRP:[]
                },
                springLoads: {
                    TP: [],
                    DRP:[]
                },
                springFlow: {
                    TP: [],
                    DRP: []
                }
            };
            return river;
        };

        function addTP(river, fieldset, newVal) {
            river[fieldset].TP.push(numberFormat(newVal));
        };
        function addDRP(river, fieldset, newVal) {
            river[fieldset].DRP.push(numberFormat(newVal));
        }
        var dateFormat = d3.time.format("%Y").parse;
        var numberFormat = d3.format(".4f");

        
        d3.csv("data/NCWQR Lake Erie tribs_GLC_031617_sample_4_Siyu_input.csv", function (in_file) {
            var dateFormat = d3.time.format("%Y").parse;
            var numberFormat = d3.format(".2f");

            in_file.forEach(function (d) {
                d.Year = dateFormat(d.Year).getFullYear();
                d.riverField = d.River + ":" + d.FIELD_SET;
                if (d.NOS == "") {
                    d.NOS = 0;
                }
                if (d.Discharge == "") {
                    d.Discharge = 0;
                }
                if (d.TN == "") {
                    d.TN = 0;
                }
                if (d.PTN == "") {
                    d.PTN = 0;
                }
                if (d.TPP == "") {
                    d.TPP = 0;
                }
                if (d.PP == "") {
                    d.PP = 0;
                }
            });

            var data = crossfilter(in_file);

            riverFieldDim = data.dimension(function (d) {
                //return d.riverField;
                return [d.River, d.FIELD_SET];
            });
            var riverGroup = riverFieldDim.group().reduce(
                function (p, v) {

                },
                function (p, v) {

                },
                function () {
                    return {};
                }
                );


        });

        d3.csv("data/NCWQR Lake Erie tribs_GLC_031617_sample_4_Siyu_input.csv", function (in_file) {            

            function calculateFieldset(line){
                switch(line.FIELD_SET){
                    case "Loads":
                        return "loads";
                    case "Unit Area Loads":
                        return "ual";
                    case "Flow-weighted mean concentrations":
                        return "flowWeighted";
                    case "Time-weighted mean concentrations":
                        return "timeWeighted";
                    case "Spring Loads":
                        return "springLoads";
                    case "Spring Flow-weighted mean concentrations":
                        return "springFlow";
                }               
            }

            in_file.forEach(function (d) {
                d.Year = dateFormat(d.Year).getFullYear();
                d.riverField = d.River + ":" + d.FIELD_SET;
                if (d.NOS == "") {
                    d.NOS = 0;
                }
                if (d.Discharge == "") {
                    d.Discharge = 0;
                }
                if (d.TN == "") {
                    d.TN = 0;
                }
                if (d.PTN == "") {
                    d.PTN = 0;
                }
                if (d.TPP == "") {
                    d.TPP = 0;
                }
                if (d.PP == "") {
                    d.PP = 0;
                }
                d.fieldset = calculateFieldset(d);
            });
            
            var RaisinSeries = createRiver("Raisin");
            var MaumeeSeries = createRiver("Maumee");
            var PortageSeries = createRiver("Portage");                

            var vals = in_file.map(function (obj) {
                if (obj.River == "Raisin") {
                    //RaisinSeries[obj.fieldset].TP.push(obj.TP);
                    //RaisinSeries[obj.fieldset].DRP.push(obj.DRP);

                    RaisinSeries[obj.fieldset].TP.splice(obj.Year-2008, 0, parseFloat(obj.TP));
                    RaisinSeries[obj.fieldset].DRP.splice(obj.Year - 2008, 0, parseFloat(obj.DRP));
                }else if(obj.River == "Maumee"){
                    MaumeeSeries[obj.fieldset].TP.splice(obj.Year - 2008, 0, parseFloat(obj.TP));
                    MaumeeSeries[obj.fieldset].DRP.splice(obj.Year - 2008, 0, parseFloat(obj.DRP));
                }else{
                    PortageSeries[obj.fieldset].TP.splice(obj.Year - 2008, 0, parseFloat(obj.TP));
                    PortageSeries[obj.fieldset].DRP.splice(obj.Year - 2008, 0, parseFloat(obj.DRP));
                }
            });
            var xAxis = ["2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015"];
            var target = [];
            for (var i = 0; i < RaisinSeries.loads.TP.length; i++){
                target.push(1000);
            }
            var dataSeries = [
                { name: "TP", data: RaisinSeries.loads.TP },
                { name: "DRP", data: RaisinSeries.loads.DRP },
                {name: "Target", data: target, color: "#FF0000"}
            ];
            var options = createOptions("raisinchart1", "Raisin Loads", xAxis, "Units (Millgram/Ton)", dataSeries);
            var chart = new Highcharts.Chart(options);

            target = [];
            for (var i = 0; i < RaisinSeries.loads.TP.length; i++) {
                target.push(0.05);
            }
            dataSeries = [
                { name: "TP", data: RaisinSeries.flowWeighted.TP },
                { name: "DRP", data: RaisinSeries.flowWeighted.DRP },
                { name: "Target", data: target, color: "#FF0000" }
            ];
            options = createOptions("raisinchart2", "Raisin Flow Weighted", xAxis, "Units (Gram/Cubic Meter)", dataSeries);
            options.plotOptions = {
                series: {
                    allowPointSelect: true
                }
            };
            chart = new Highcharts.Chart(options);          
                       
            target = [];
            for (var i = 0; i < MaumeeSeries.loads.TP.length; i++) {
                target.push(0.05);
            }
            dataSeries = [
                { name: "TP", data: MaumeeSeries.ual.TP },
                { name: "DRP", data: MaumeeSeries.ual.DRP },
                { name: "Target", data: target, color: "#FF0000" }
            ];
            options = createOptions("maumeechart1", "Maumee Unit Area Loads", xAxis, "Units", dataSeries);
            options.plotOptions = {
                series: {
                    allowPointSelect: true
                }
            };
            chart = new Highcharts.Chart(options);

            target = [];
            for (var i = 0; i < MaumeeSeries.loads.TP.length; i++) {
                target.push(0.05);
            }
            dataSeries = [
                { name: "TP", data: MaumeeSeries.timeWeighted.TP },
                { name: "DRP", data: MaumeeSeries.timeWeighted.DRP },
                { name: "Target", data: target, color: "#FF0000" }
            ];
            options = createOptions("maumeechart2", "Maumee Time-Weighted Mean Concentrations", xAxis, "Units", dataSeries);
            options.plotOptions = {
                series: {
                    allowPointSelect: true
                }
            };
            chart = new Highcharts.Chart(options);

            target = [];
            for (var i = 0; i < PortageSeries.loads.TP.length; i++) {
                target.push(300);
            }
            dataSeries = [
                { name: "TP", data: PortageSeries.springLoads.TP },
                { name: "DRP", data: PortageSeries.springLoads.DRP },
                { name: "Target", data: target, color: "#FF0000" }
            ];
            options = createOptions("portagechart1", "Portage Spring Loads", xAxis, "Units", dataSeries);
            options.plotOptions = {
                series: {
                    allowPointSelect: true
                }
            };
            chart = new Highcharts.Chart(options);

            target = [];
            for (var i = 0; i < PortageSeries.loads.TP.length; i++) {
                target.push(500);
            }
            dataSeries = [
                { type: "area", name: "TP", data: PortageSeries.springFlow.TP },
                //{ name: "DRP", data: PortageSeries.springFlow.DRP, color: "#000099" },
                {type: "column", name: "DRP", data: PortageSeries.springFlow.DRP, color: "#000099"},
                { name: "Target", data: target, color: "#FF0000" }
            ];
            options = createOptions("portagechart2", "Portage Spring Flow", xAxis, "Units", dataSeries);
            options.plotOptions = {
                series: {
                    allowPointSelect: true
                }                
            };
            chart = new Highcharts.Chart(options);



            var myArray = {};            
        });
            var test;
        
    </script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <table>
                <tr>
                    <td><div id="raisinchart1"></div></td>                    
                    <td><div id="maumeechart1"></div></td>
                    <td><div id="portagechart1"></div></td>
                </tr>
                <tr>
                    <td>
                        <div id="raisinchart2"></div>
                    </td>
                    <td>
                        <div id="maumeechart2"></div>
                    </td>
                    <td><div id="portagechart2"></div></td>
                </tr>

            </table>
            <!--<div style="width:400px">
                <div id="raisinchart1"></div>
                <div id="raisinchart2"></div>
            </div>
            <div style="width:400px">
                <div id="maumeechart1"></div>
                <div id="maumeechart2"></div>
            </div>-->
        </div>

    </div>
</body>
</html>